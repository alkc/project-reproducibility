---
title: "Reproducibility Project"
subtitle: "Assignment for PVG0038 Reproducibility in Research with a focus on data analysis using the program R"
author: "Alexander Koc"
date: '2020-11-04'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Abstract

Hello world.

## Materials and Methods 

## Results

### Data preparation

```{r libs_and_data, message=FALSE}
library(tidyverse)
library(caret)
library(lubridate)
library(here)

# Create variable specification for dataset:
col_spec <- cols(
  .default = col_double(),
  datetime = col_datetime(format = ""),
  season = col_integer(),
  holiday = col_logical(),
  workingday = col_logical(),
  weather = col_factor(),
  count = col_integer()
)

bikeshare <- read_csv(here::here("data/train.csv"), col_types = col_spec)
```

We drop the `casual` and `registered` columns, as they add up to the `count` column anyway -- making it a linear 
combination of both.

```{r}
bikeshare <- bikeshare %>% 
  select(-registered, -casual)
```


Expand season names:

```{r}
bikeshare <- bikeshare %>% 
  mutate(season = map_chr(season, function(season_code) {
    
    seasons <- c("spring" = 1, "summer" = 2,  "fall" = 3, winter = "4")
    translated_name <- names(seasons[season_code])
    
    if(is.na(translated_name)) {
      err <- paste("Invalid season code:", season_code)
      stop(err)
    }
    
    return(translated_name)
    
  }))

```

I expand some column names to spell out what they actually are and rename others to make data set look nicer. The latter
part is totally necessary.

```{r}
bikeshare <-  bikeshare %>% 
  rename(
    date_time = datetime,
    working_day = workingday,
    temp_celcius = temp,
    feels_like_temp_celcius = atemp,
    relative_humidity = humidity,
    wind_speed = windspeed,
    total_nbr_rentals = count
  )
```

Finally, the hour at which bikes are rented _feels_ like it should have some predictive power. Split the date time
into a time column:

```{r}
bikeshare <- bikeshare %>% 
  mutate(hour = hour(date_time)) %>% 
  select(date_time, hour, everything())
```


Final data set:

```{r}
glimpse(bikeshare)
```

### Data exploration:

Check for missing data:
 
```{r}
bikeshare %>% 
  is.na %>% 
  any()
```
 
Check for correlation between counts and numeric variables
 
```{r}
cor_mat <- bikeshare %>% 
  select(where(is.numeric)) %>% 
  cor(method = "spearman")

cor_mat

```
Exploring categorical variables:
 
```{r}
bikeshare %>% 
  ggplot(aes(x = weather, y = total_nbr_rentals)) +
  geom_violin() 
```
```{r}
bikeshare %>% 
  ggplot(aes(x = season, y = total_nbr_rentals)) +
  geom_violin()
```
Move on to numeric variables. 

Start with hour:


```{r}
bikeshare %>% 
  ggplot(aes(x = hour, y = total_nbr_rentals)) +
  geom_jitter(alpha = 0.1)
```
```{r}
bikeshare %>% 
  ggplot(aes(x = hour, y = total_nbr_rentals)) +
  geom_jitter(alpha = 0.1) + 
  facet_wrap(~season)
```
```{r}
bikeshare %>% 
  ggplot(aes(x = hour, y = total_nbr_rentals)) +
  geom_jitter(alpha = 0.1) + 
  facet_wrap(~weather)
```
There seems to be only one data point for weather type four. Useless.

```{r}
bikeshare <- bikeshare %>% 
  filter(weather != 4)
```



```{r}
bikeshare %>% 
  ggplot(aes(x = wind_speed, y = total_nbr_rentals)) + 
  geom_jitter(alpha = 0.1)
```
```{r}
bikeshare %>% 
  ggplot(aes(x = temp_celcius, y = total_nbr_rentals)) + 
  geom_jitter(alpha = 0.1)
```
### Model

Create test and train data set

```{r}

```


## Literature

## Session

Packages and R version used in my analysis.

```{r}
devtools::session_info()
```

